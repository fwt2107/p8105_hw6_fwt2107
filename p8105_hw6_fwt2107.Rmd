---
title: "p8105_hw6_fwt2107"
author: "Felix Tran"
date: "November 17, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_bw() + theme(legend.position = "right"))
```

# Problem 1

### Data cleaning

1. Read in the dataset from the Washington Post's github page

2. Create a **city_state** variable to combine each homicide's city and state

3. Remove all homicides which were recorded in Dallas, TX; Phoenix, AZ; Kansas
City, MO; and Tulsa, AL

4. Transform **victim_age** into a numeric variable

5. Transform **victim_race** into a binary variable (white vs. non-white)

6. Create a **solved_binary** binary variable for the outcome of each homicide
(1 (solved) vs. 0 (unsolved))
```{r}
data_url <- RCurl::getURL('https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv')

homicide_df <- readr::read_csv(data_url) %>% 
  mutate(city_state = stringr::str_c(city, ', ',state)) %>% 
  filter(!(city_state %in% c('Dallas, TX', 'Phoenix, AZ', 'Kansas City, MO', 
                             'Tulsa, AL'))) %>% 
  mutate(victim_age = as.numeric(victim_age),
         victim_race = ifelse(victim_race == "White", "white", "non-white"),
         solved_binary = ifelse(disposition == "Closed by arrest", 1, 0))
```

### Fitting a logistic regression model for resolved vs. unresolved homicides
### in Baltimore, MD

1. Use the *glm()* function to run a logistic regression modeling the logit
of the probability of a murder being resolved on victim age, sex, and race
in Baltimore, MD.

2. Use *broom::tidy()* to clean the output and compute the OR's and 95% CI for
the estimates
```{r}
baltimore_log <- glm(solved_binary ~ victim_age + victim_sex + victim_race,
                     data = homicide_df, family = binomial())

baltimore_log %>% 
  broom::tidy(.) %>% 
  mutate(OR = exp(estimate),
         CI_lower_limit = exp(estimate - 1.96*std.error),
         CI_upper_limit = exp(estimate + 1.96*std.error)) %>% 
  select(term, estimate, OR, CI_lower_limit, CI_upper_limit)
```
After adjusting for victim age and sex, homicides in Baltimore, MD in which the 
victim was white had approximately 1.78 times the odds of being resolved 
compared to homicides in which the victim was non-white. We are 95% confident
that Baltimore homicides involving white victims had between 1.68 to 1.89 times
the odds of being resolved compared to homicides involving non-white victims.



